<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignments</title>

    <!--FONTS-->
    <link rel="stylesheet" href="style/assignmentsTeacherStyle.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap"
        rel="stylesheet">

    <script src="javascript/dashboardscript.js"></script>
</head>

<body class="josefin-sans-regular">
    <div class="container">
        <div class="side-bar red">
            <div class="container-1">
                <img src="./res/WhatsApp_Image_2024-05-24_at_12.26.37-removebg-preview.png" alt="Somtoday logo" class="logo">
                <p class="logo-text">somtoday</p>
            </div>
            <div class="container-2">
                <ul class="navigations">
                    <li class="nav-item">
                        <a href="dashboard.html" class="nav-link">
                            <i class="nav-item-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                                    <path
                                            d="M240-200h120v-240h240v240h120v-360L480-740 240-560v360Zm-80 80v-480l320-240 320 240v480H520v-240h-80v240H160Zm320-350Z" />
                                </svg>
                            </i>
                            <p class="nav-item-text">Home</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="assignments-teacher.html" class="nav-link">
                            <i class="nav-item-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                                    <path
                                            d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h168q13-36 43.5-58t68.5-22q38 0 68.5 22t43.5 58h168q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm80-80h280v-80H280v80Zm0-160h400v-80H280v80Zm0-160h400v-80H280v80Zm200-190q13 0 21.5-8.5T510-820q0-13-8.5-21.5T480-850q-13 0-21.5 8.5T450-820q0 13 8.5 21.5T480-790ZM200-200v-560 560Z" />
                                </svg>
                            </i>
                            <p class="nav-item-text">Assignments</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="notifications.html" class="nav-link">
                            <i class="nav-item-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                                    <path
                                            d="M160-200v-80h80v-280q0-83 50-147.5T420-792v-28q0-25 17.5-42.5T480-880q25 0 42.5 17.5T540-820v28q80 20 130 84.5T720-560v280h80v80H160Zm320-300Zm0 420q-33 0-56.5-23.5T400-160h160q0 33-23.5 56.5T480-80ZM320-280h320v-280q0-66-47-113t-113-47q-66 0-113 47t-47 113v280Z" />
                                </svg>
                            </i>
                            <p class="nav-item-text">Notifications</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="classes.html" class="nav-link">
                            <i class="nav-item-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                                    <path
                                            d="M560-564v-68q33-14 67.5-21t72.5-7q26 0 51 4t49 10v64q-24-9-48.5-13.5T700-600q-38 0-73 9.5T560-564Zm0 220v-68q33-14 67.5-21t72.5-7q26 0 51 4t49 10v64q-24-9-48.5-13.5T700-380q-38 0-73 9t-67 27Zm0-110v-68q33-14 67.5-21t72.5-7q26 0 51 4t49 10v64q-24-9-48.5-13.5T700-490q-38 0-73 9.5T560-454ZM260-320q47 0 91.5 10.5T440-278v-394q-41-24-87-36t-93-12q-36 0-71.5 7T120-692v396q35-12 69.5-18t70.5-6Zm260 42q44-21 88.5-31.5T700-320q36 0 70.5 6t69.5 18v-396q-33-14-68.5-21t-71.5-7q-47 0-93 12t-87 36v394Zm-40 118q-48-38-104-59t-116-21q-42 0-82.5 11T100-198q-21 11-40.5-1T40-234v-482q0-11 5.5-21T62-752q46-24 96-36t102-12q58 0 113.5 15T480-740q51-30 106.5-45T700-800q52 0 102 12t96 36q11 5 16.5 15t5.5 21v482q0 23-19.5 35t-40.5 1q-37-20-77.5-31T700-240q-60 0-116 21t-104 59ZM280-494Z" />
                                </svg>
                            </i>
                            <p class="nav-item-text">Classes</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="lessons.html" class="nav-link">
                            <i class="nav-item-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                                    <path
                                            d="M480-120 200-272v-240L40-600l440-240 440 240v320h-80v-276l-80 44v240L480-120Zm0-332 274-148-274-148-274 148 274 148Zm0 241 200-108v-151L480-360 280-470v151l200 108Zm0-241Zm0 90Zm0 0Z" />
                                </svg>
                            </i>
                            <p class="nav-item-text">Lessons</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#profile" class="nav-link">
                            <i class="nav-item-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                                    <path
                                            d="M480-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47ZM160-160v-112q0-34 17.5-62.5T224-378q62-31 126-46.5T480-440q66 0 130 15.5T736-378q29 15 46.5 43.5T800-272v112H160Zm80-80h480v-32q0-11-5.5-20T700-306q-54-27-109-40.5T480-360q-56 0-111 13.5T260-306q-9 5-14.5 14t-5.5 20v32Zm240-320q33 0 56.5-23.5T560-640q0-33-23.5-56.5T480-720q-33 0-56.5 23.5T400-640q0 33 23.5 56.5T480-560Zm0-80Zm0 400Z" />
                                </svg>
                            </i>
                            <p class="nav-item-text">Profile</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#help" class="nav-link">
                            <i class="nav-item-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                                    <path
                                            d="M478-240q21 0 35.5-14.5T528-290q0-21-14.5-35.5T478-340q-21 0-35.5 14.5T428-290q0 21 14.5 35.5T478-240Zm-36-154h74q0-33 7.5-52t42.5-52q26-26 41-49.5t15-56.5q0-56-41-86t-97-30q-57 0-92.5 30T342-618l66 26q5-18 22.5-39t53.5-21q32 0 48 17.5t16 38.5q0 20-12 37.5T506-526q-44 39-54 59t-10 73Zm38 314q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z" />
                                </svg>
                            </i>
                            <p class="nav-item-text">Help</p>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="container-3">
                <div>
                    <a href="#logout" class="nav-link">
                        <i class="logout-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                                <path
                                        d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h280v80H200Zm440-160-55-58 102-102H360v-80h327L585-622l55-58 200 200-200 200Z" />
                            </svg>
                        </i>
                        <p>Logout</p>
                    </a>
                </div>
            </div>
        </div>
        <main class="main-content">
            <header class="header">
                <h1>Dashboard</h1>
                <div class="user-settings">
                    <input type="text" id="search-bar" placeholder="Search">
                    <div id="search-results" class="search-results"></div>
                    <div class="user-info">
                        <span>Welcome, Student_Name!</span>
                        <a href="user-profile.html"><img src="res/user-icon.png" alt="User Icon"></a>
                    </div>
                </div>
            </header>
            <h3 class="page-hdn">All Assignments For All Classes</h3>
            <section class="content">
                <div class="table-scroll">
                    <table>
                        <thead>
                            <tr>
                                <th>Class Name</th>
                                <th>Assignment Name</th>
                                <th>Date Created</th>
                                <th>Due Date</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="table-body">
                        </tbody>
                    </table>
                </div>
                <button class="add-new" id="add-button" onclick="location.href='create-assignment.html'">Add new assignment</button>
            </section>
        </main>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const role = sessionStorage.getItem('role');
            const personId = sessionStorage.getItem('personId');
            const sidebar = document.querySelector('.side-bar');
            const addBtn = document.getElementById("add-button");

            sidebar.classList.remove('red', 'yellow', 'green'); // Remove any existing color classes
            if (role === 'admin') {
                console.log('Setting sidebar color to green for admin');
                console.log('Admin - add assignment button removed');
                sidebar.classList.add('green');
                addBtn.classList.add('hidden');
            } else if (role === 'teacher') {
                console.log('Setting sidebar color to yellow for teacher');
                sidebar.classList.add('yellow');
            } else if (role === 'student') {
                console.log('Setting sidebar color to red for student');
                console.log('Student - add assignment button removed');
                sidebar.classList.add('red');
                addBtn.classList.add('hidden');
            }

            if (role && personId) {
                fetch(`api/fetchAssignments?role=${role}&personId=${personId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Fetched data:', data);
                        const assignments = data.homeworks;
                        const splits = data.splits;
                        const assignmentContainer = document.getElementById('table-body');
                        assignmentContainer.innerHTML = '';

                        if (Array.isArray(assignments)) {
                            assignments.forEach(assignmentData => {
                                const row = document.createElement('tr');

                                const className = document.createElement('td');
                                className.innerText = assignmentData.class_name;

                                const homeworkType = document.createElement('td');
                                homeworkType.innerText = assignmentData.homework_name;

                                const publishDate = document.createElement('td');
                                publishDate.innerText = assignmentData.publish_date;

                                const dueDate = document.createElement('td');
                                dueDate.innerText = assignmentData.due_date;

                                const detailsButton = document.createElement('td');
                                const detailsLink = document.createElement('a');
                                if (role === 'student') {
                                    detailsLink.href = `assignment-details-student.html?id=${assignmentData.homework_id}`;
                                } else {
                                    detailsLink.href = `assignments-of-class.html?homeworkId=${assignmentData.homework_id}`;
                                }
                                detailsLink.innerHTML = 'See Details';
                                detailsButton.appendChild(detailsLink);

                                row.appendChild(className);
                                row.appendChild(homeworkType);
                                row.appendChild(publishDate);
                                row.appendChild(dueDate);
                                row.appendChild(detailsButton);

                                assignmentContainer.appendChild(row);
                            });
                        } else {
                            console.error('Assignments data is missing or not an array');
                        }

                        if (Array.isArray(splits)) {
                            splits.forEach(splitData => {
                                const correspondingHomework = assignments.find(hw => hw.homework_id === splitData.homework_id);
                                if (correspondingHomework) {
                                    const row = document.createElement('tr');
                                    row.innerHTML = `
                                    <td>${correspondingHomework.class_name}</td>
                                    <td>${correspondingHomework.homework_name} ${splitData.split_name}</td>
                                    <td>${correspondingHomework.publish_date}</td>
                                    <td>${correspondingHomework.due_date}</td>
                                    <td><a href="assignment-split-details.html?splitId=${splitData.split_id}&homeworkId=${splitData.homework_id}">See Details</a></td>
                                `;
                                    assignmentContainer.appendChild(row);
                                }
                            });
                        } else {
                            console.error('Splits data is missing or not an array');
                        }
                    })
                    .catch(error => console.error('Error fetching assignments:', error));
            } else {
                console.error('Missing role or personId in session storage');
            }
        });
    </script>

</body>

</html>