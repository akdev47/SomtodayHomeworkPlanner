<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login</title>
  <link rel="stylesheet" href="style/loginstyle.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet" />
</head>

<body>
<div class="login-page red">
  <div class="container-1">
    <img src="./res/WhatsApp_Image_2024-05-24_at_12.26.37-removebg-preview.png" alt="Somtoday logo" class="logo" />
    <p class="logo-text">somtoday</p>
  </div>
  <div class="container-2">
    <p class="sign-in">Sign In</p>
    <form id="loginForm">
      <input type="text" id="username" name="username" placeholder="Username" required />
      <input type="password" id="password" name="password" placeholder="Password" required />
      <div class="buttons">
        <button type="button" onclick="window.location.href='forgot-password.html'" aria-label="Forgotten password?">Forgotten password?</button>
        <button type="submit" aria-label="Login">Login</button>
      </div>
    </form>

    <div id="error-message" style="color: red; display: none;">Invalid username or password</div>
  </div>
</div>

<script>
  document.getElementById('loginForm').addEventListener('submit', function(event) {
    event.preventDefault();

    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    fetch('login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: new URLSearchParams({
        username: username,
        password: password
      })
    })
            .then(response => {
              if (!response.ok) {
                throw new Error('Login failed');
              }
              return response.json();
            })
            .then(data => {
              if (data.error) {
                document.getElementById('error-message').textContent = 'Invalid username or password';
                document.getElementById('error-message').style.display = 'block';
              } else {
                //save cookies to use later!
                sessionStorage.setItem('role', data.role);
                sessionStorage.setItem('personId', data.personId);
                sessionStorage.setItem('personName', data.personName);
                window.location.href = 'dashboard.html';
              }
            })
            .catch(error => {
              console.error('Error:', error);
              document.getElementById('error-message').textContent = 'Wrong username or password. Please try again.';
              document.getElementById('error-message').style.display = 'block';
            });
  });

  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.has('error')) {
    document.getElementById('error-message').style.display = 'block';
  }
</script>
</body>
</html>
