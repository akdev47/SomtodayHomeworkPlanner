<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Somtoday Profile</title>
    <link rel="stylesheet" href="style/profilestyle.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
</head>
<body class="josefin-sans-regular">
<div class="container">
    <div class="side-bar blue" id="sidebar">
        <div class="container-1">
            <img src="./res/WhatsApp_Image_2024-05-24_at_12.26.37-removebg-preview.png" alt="Somtoday logo" class="logo">
            <p class="logo-text">somtoday</p>
        </div>
        <div class="container-2">
            <ul class="navigations">
                <li class="nav-item">
                    <a href="dashboard.html" class="nav-link">
                        <i class="nav-item-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                                <path d="M240-200h120v-240h240v240h120v-360L480-740 240-560v360Zm-80 80v-480l320-240 320 240v480H520v-240h-80v240H160Zm320-350Z" />
                            </svg>
                        </i>
                        <p class="nav-item-text">Home</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="assignments-teacher.html" class="nav-link">
                        <i class="nav-item-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                                <path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h168q13-36 43.5-58t68.5-22q38 0 68.5 22t43.5 58h168q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm80-80h280v-80H280v80Zm0-160h400v-80H280v80Zm0-160h400v-80H280v80Zm200-190q13 0 21.5-8.5T510-820q0-13-8.5-21.5T480-850q-13 0-21.5 8.5T450-820q0 13 8.5 21.5T480-790ZM200-200v-560 560Z" />
                            </svg>
                        </i>
                        <p class="nav-item-text">Assignments</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="notifications.html" class="nav-link">
                        <i class="nav-item-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                                <path d="M160-200v-80h80v-280q0-83 50-147.5T420-792v-28q0-25 17.5-42.5T480-880q25 0 42.5 17.5T540-820v28q80 20 130 84.5T720-560v280h80v80H160Zm320-300Zm0 420q-33 0-56.5-23.5T400-160h160q0 33-23.5 56.5T480-80ZM320-280h320v-280q0-66-47-113t-113-47q-66 0-113 47t-47 113v280Z" />
                            </svg>
                        </i>
                        <p class="nav-item-text">Notifications</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="classes.html" class="nav-link">
                        <i class="nav-item-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                                <path d="M560-564v-68q33-14 67.5-21t72.5-7q26 0 51 4t49 10v64q-24-9-48.5-13.5T700-600q-38 0-73 9.5T560-564Zm0 220v-68q33-14 67.5-21t72.5-7q26 0 51 4t49 10v64q-24-9-48.5-13.5T700-380q-38 0-73 9t-67 27Zm0-110v-68q33-14 67.5-21t72.5-7q26 0 51 4t49 10v64q-24-9-48.5-13.5T700-490q-38 0-73 9.5T560-454ZM260-320q47 0 91.5 10.5T440-278v-394q-41-24-87-36t-93-12q-36 0-71.5 7T120-692v396q35-12 69.5-18t70.5-6Zm260 42q44-21 88.5-31.5T700-320q36 0 70.5 6t69.5 18v-396q-33-14-68.5-21t-71.5-7q-47 0-93 12t-87 36v394Zm-40 118q-48-38-104-59t-116-21q-42 0-82.5 11T100-198q-21 11-40.5-1T40-234v-482q0-11 5.5-21T62-752q46-24 96-36t102-12q58 0 113.5 15T480-740q51-30 106.5-45T700-800q52 0 102 12t96 36q11 5 16.5 15t5.5 21v482q0 23-19.5 35t-40.5 1q-37-20-77.5-31T700-240q-60 0-116 21t-104 59ZM280-494Z" />
                            </svg>
                        </i>
                        <p class="nav-item-text">Classes</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="lessons.html" class="nav-link">
                        <i class="nav-item-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                                <path d="M480-120 200-272v-240L40-600l440-240 440 240v320h-80v-276l-80 44v240L480-120Zm0-332 274-148-274-148-274 148 274 148Zm0 241 200-108v-151L480-360 280-470v151l200 108Zm0-241Zm0 90Zm0 0Z" />
                            </svg>
                        </i>
                        <p class="nav-item-text">Lessons</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="profile.html" class="nav-link" id="profileLink">
                        <i class="nav-item-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                                <path d="M480-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47ZM160-160v-112q0-34 17.5-62.5T224-378q62-31 126-46.5T480-440q66 0 130 15.5T736-378q29 15 46.5 43.5T800-272v112H160Zm80-80h480v-32q0-11-5.5-20T700-306q-54-27-109-40.5T480-360q-56 0-111 13.5T260-306q-9 5-14.5 14t-5.5 20v32Zm240-320q33 0 56.5-23.5T560-640q0-33-23.5-56.5T480-720q-33 0-56.5 23.5T400-640q0 33 23.5 56.5T480-560Zm0-80Zm0 400Z" />
                            </svg>
                        </i>
                        <p class="nav-item-text">Profile</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#help" class="nav-link">
                        <i class="nav-item-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                                <path
                                        d="M478-240q21 0 35.5-14.5T528-290q0-21-14.5-35.5T478-340q-21 0-35.5 14.5T428-290q0 21 14.5 35.5T478-240Zm-36-154h74q0-33 7.5-52t42.5-52q26-26 41-49.5t15-56.5q0-56-41-86t-97-30q-57 0-92.5 30T342-618l66 26q5-18 22.5-39t53.5-21q32 0 48 17.5t16 38.5q0 20-12 37.5T506-526q-44 39-54 59t-10 73Zm38 314q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z" />
                            </svg>
                        </i>
                        <p class="nav-item-text">Help</p>
                    </a>
                </li>
            </ul>
        </div>
        <div class="container-3">
            <div>
                <a href="#logout" class="nav-link log-out">
                    <i class="logout-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                            <path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h280v80H200Zm440-160-55-58 102-102H360v-80h327L585-622l55-58 200 200-200 200Z"/>
                        </svg>
                    </i>
                    <p>Logout</p>
                </a>
            </div>
        </div>
    </div>
    <main class="main-content">
        <header class="header">
            <div class="back-button">
                <button onclick="window.location.href='dashboard.html'">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                        <path d="M480-120L280-320l200-200 40 40-120 120h480v80H400l120 120-40 40ZM960-480ZM0-480h960" />
                    </svg>
                </button>
            </div>
            <h1>My Profile</h1>
            <div class="user-settings">
                <!-- User settings content -->
            </div>
        </header>
        <section class="profile-section" id="profile-view">
            <div class="profile-header">
                <div class="profile-picture">
                    <img src="res/user-icon.png" alt="Profile Picture">
                </div>
                <div class="profile-info">
                    <h2 id="personName">Person Name</h2>
                </div>
            </div>
            <div class="profile-details">
                <h3>Personal Details</h3>
                <table>
                    <tr>
                        <td>First Name</td>
                        <td id="firstName">name</td>
                    </tr>
                    <tr>
                        <td>Last Name</td>
                        <td id="lastName">last name</td>
                    </tr>
                    <tr>
                        <td>Birth Date</td>
                        <td id="birthDate">YYYY-MM-DD</td>
                    </tr>
                    <tr>
                        <td>Gender</td>
                        <td id="gender">M/F</td>
                    </tr>
                    <tr>
                        <td>Email Address</td>
                        <td id="email">exampleemail@domain.com</td>
                    </tr>
                    <tr id="username-field">
                        <td>Username</td>
                        <td id="username">username</td>
                    </tr>
                    <tr id="password-field">
                        <td>Password</td>
                        <td id="password">password</td>
                    </tr>
                </table>
                <button id="editProfileBtn" class="edit-profile-btn">Edit Profile</button>
            </div>
        </section>

        <section class="profile-section" id="edit-profile-view" style="display: none;">
            <div class="profile-header">
                <div class="profile-picture">
                    <img src="res/user-icon.png" alt="Profile Picture">
                </div>
                <div class="profile-info">
                    <h2>Person Name</h2>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                </div>
            </div>
            <div class="profile-details">
                <h3>Personal Details</h3>
                <form id="editProfileForm">
                    <table>
                        <tr>
                            <td>First Name</td>
                            <td><input type="text" id="firstNameE" name="person_name" value="name"></td>
                        </tr>
                        <tr>
                            <td>Last Name</td>
                            <td><input type="text" id="lastNameE" name="last_name" value="last name"></td>
                        </tr>
                        <tr>
                            <td>Birth Date</td>
                            <td><input type="date" id="birthDateE" name="birth_date" value="YYYY-MM-DD"></td>
                        </tr>
                        <tr>
                            <td>Gender</td>
                            <td>
                                <select id="genderE" name="person_gender">
                                    <option value="M">Male</option>
                                    <option value="F">Female</option>
                                    <option value="O">Other</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>Email Address</td>
                            <td><input type="email" id="emailE" name="email_address" value="exampleemail@domain.com"></td>
                        </tr>
                        <tr>
                            <td>Username</td>
                            <td><input type="text" id="usernameE" name="username" value="username"></td>
                        </tr>
                        <tr>
                            <td>Password</td>
                            <td><input type="password" id="passwordE" name="user_password" value="password"></td>
                        </tr>
                    </table>
                    <button type="submit" class="save-profile-btn">Save Changes</button>
                    <button type="button" id="cancelEditBtn" class="cancel-edit-btn">Cancel</button>
                </form>
            </div>
        </section>
    </main>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const viewedPersonId = urlParams.get('personId');
        const role = sessionStorage.getItem('role');
        const personId = sessionStorage.getItem('personId');
        const personName = sessionStorage.getItem('personName');

        const sidebar = document.querySelector('.side-bar');
        const editProfileBtn = document.getElementById('editProfileBtn');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const editProfileForm = document.getElementById('editProfileForm');
        const profileView = document.getElementById('profile-view');
        const editProfileView = document.getElementById('edit-profile-view');
        const usernameField = document.getElementById('username-field');
        const passwordField = document.getElementById('password-field');

        console.log('Role:', role);
        console.log('Person ID:', personId);
        console.log('Viewed Person ID:', viewedPersonId);
        console.log('Person Name:', personName);

        sidebar.classList.remove('red', 'yellow', 'green');
        if (role === 'admin') {
            sidebar.classList.add('green');
        } else if (role === 'teacher') {
            sidebar.classList.add('yellow');
        } else if (role === 'student') {
            sidebar.classList.add('red');
        }

        function fetchProfileInfo() {
            fetch(`api/profile?personId=${viewedPersonId}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('personName').innerText = data.person_name;
                    document.getElementById('firstName').innerText = data.person_name.split(' ')[0];
                    document.getElementById('lastName').innerText = data.person_name.split(' ').slice(1).join(' ');
                    document.getElementById('birthDate').innerText = data.birth_date;
                    document.getElementById('gender').innerText = data.person_gender;
                    document.getElementById('email').innerText = data.email_address;
                    if (viewedPersonId === personId) {
                        document.getElementById('username').innerText = data.username;
                        document.getElementById('password').innerText = data.user_password;
                        document.getElementById('usernameE').value = data.username;
                        document.getElementById('passwordE').value = data.user_password;
                    }

                    document.getElementById('firstNameE').value = data.person_name.split(' ')[0];
                    document.getElementById('lastNameE').value = data.person_name.split(' ').slice(1).join(' ');
                    document.getElementById('birthDateE').value = data.birth_date;
                    document.getElementById('genderE').value = data.person_gender;
                    document.getElementById('emailE').value = data.email_address;
                })
                .catch(error => console.error('Error fetching profile info:', error));
        }

        function showEditProfileView() {
            profileView.style.display = 'none';
            editProfileView.style.display = 'block';
        }

        function showProfileView() {
            profileView.style.display = 'block';
            editProfileView.style.display = 'none';
        }

        if (viewedPersonId !== personId) {
            editProfileBtn.style.display = 'none';
            usernameField.style.display = 'none';
            passwordField.style.display = 'none';
        } else {
            editProfileBtn.addEventListener('click', showEditProfileView);
            cancelEditBtn.addEventListener('click', showProfileView);

            editProfileForm.addEventListener('submit', (event) => {
                event.preventDefault();

                const formData = new FormData(editProfileForm);
                const jsonData = {};
                formData.forEach((value, key) => {
                    jsonData[key] = value;
                });

                fetch(`api/profile?personId=${personId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(jsonData)
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            fetchProfileInfo();
                            showProfileView();
                        } else {
                            console.error('Error updating profile:', data.message);
                        }
                    })
                    .catch(error => console.error('Error updating profile:', error));
            });
        }

        fetchProfileInfo();
    });

</script>

</body>
</html>
